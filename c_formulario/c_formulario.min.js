window.jQuery||console.error("A libraria jQuery est\xe1 em falta."),"object"!=typeof bootstrap&&console.error("A libraria bootstrap est\xe1 em falta."),"object"!=typeof b5toast&&console.error("A libraria b5toast est\xe1 em falta."),$.fn.atualiza_tooltip_c_formulario=function(e,o=this){let i=new bootstrap.Tooltip(o,{containeer:"form",placement:"left",title:e,customClass:"erro_c_formulario_tooltip",template:'<div class="tooltip c_formulario" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'});return i},$.fn.hasAttr_c_formulario=function(e){return void 0!==this.attr(e)};class comparacoes{constructor(e,o,i,s){this.expressao=e,this.objeto=o,this.propriedade=i,this.valor=s}}class mensagens{constructor(e,o,i){this.ficheiro=e,this.existe=o,this.tempo_de_espera=i}}class formulario_validacoes{constructor(e,o,i,s=!1){this.num=this.length>0?this[this.length-1].num++:1,this.id=e,this.comparacao=o,this.texto_erro=i,this.mostra_resultado=s}}class formulario_erros{constructor(e,o){this.num=this.length>0?this[this.length-1].num++:1,this.funcao=e,this.mensagem_erro=o}}class formulario_objetos{constructor(e,o,i,s,t=!1){this.num=e,this.id=o,this.valor=i,this.escondido=s,this.testado=t}}class limitadores{static get inicial(){return"\xab"}static get final(){return"\xbb"}static get separador(){return"."}static get includes_inicial(){return"('"}static get includes_final(){return"')"}static get valores_inicial(){return"(("}static get valores_final(){return"))"}static get separador_valores(){return";;"}}class tipos_aviso{static get aviso_tooltip(){return"tooltip"}static get aviso_texto(){return"text"}static get aviso_toast(){return"toast"}}class constantes{static get classe_erro_tooltip(){return"erro_c_formulario_tooltip"}static get classe_esconde(){return"esconde_c_formulario"}static get classe_erro(){return"erro_c_formulario"}static get classe_geral_valido(){return"is-valid"}static get classe_geral_invalido(){return"is-invalid"}static get classe_obj_valido(){return"objeto_valido_c_formulario"}static get classe_obj_invalido(){return"objeto_invalido_c_formulario"}static get prefixo_obj_erro(){return"erro_"}static get tempo_espera(){return 3500}static get email_regex(){return/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/}static get nome_ficheiro_json(){return"c_formulario.json"}}class c_formulario{constructor(e,o){this.erros=[],this.caminho=this.#a(),this.msgs=new mensagens(this.ficheiro_mensagens,!1,3500),this.msgs.ficheiro=this.caminho+constantes.nome_ficheiro_json,this.msgs.existe=this.#b(this.msgs.ficheiro),this.msgs.tempo_de_espera=this.#b()?this.#c("tempo_de_espera"):constantes.tempo_espera,this.nome=e,this.id=this.#d(e,"#")?e:"#"+e,this.tipo_aviso=tipos_aviso.aviso_texto,this.formulario=$(this.id),this.formulario.encontrarobjetos="input,textarea,select",this.formulario.filtro="*",this.formulario.elementos=[],this.formulario.num_elementos=this.formulario.elementos.length,this.formulario.objetos=[],this.formulario.ficheiro_mensagens=void 0!=o&&this.#b(o)?this.ficheiro_mensagens:o,this.formulario.is("form")?this.#e():(this.#f("construtor",0),this.Adiciona_Erros(["Construtor","O objeto n\xe3o \xe9 um formul\xe1rio ABC "+this.id]),console.log(this.erros[0].funcao+": "+this.erros[0].mensagem_erro)),this.validacoes=[],this.validacoes.elemento_error=void 0}#d(e,o){return void 0!==e&&void 0!==o&&"string"==typeof e&&"string"==typeof o&&e.includes(o)}#g(e,o){return void 0!==e&&void 0!==o&&"string"==typeof e&&"string"==typeof o&&e.indexOf(o)}#a(){let e;return 0===this.erros.length&&$.each(document.querySelectorAll("script"),function(){if(void 0!=$(this)&&void 0!=$(this).attr("src")&&$(this).attr("src").includes("c_formulario")){let o=$(this).attr("src").lastIndexOf("/");e=$(this).attr("src").substring(0,o+1);return}}),e}#b(e){let o=!1;return $.ajax({type:"GET",url:void 0==e?this.msgs.ficheiro:e,async:!1,dataType:"json",data:{},success:function(e){o=!0}}),o}#c(e,o=-1,i){let s,t="-9999";if(!this.msgs.existe)return console.error("O ficheiro json de mensagens n\xe3o existe: "+this.msgs.ficheiro),-2;s=$.ajax({type:"GET",url:void 0==i?this.msgs.ficheiro:i,async:!1,dataType:"json",data:{},success:function(e){return JSON.stringify(e)},error:function(e,o,i){return console.error("Erro no acesso ao ficheiro de menagens!\n"+e),-1}});try{t=s.responseJSON[e]}catch(r){return console.error("A informa\xe7\xe3o "+e+" n\xe3o se encontra no ficheiro "+this.msgs.ficheiro),-1}return o>-1&&(t=s.responseJSON[e][o]),t}#f(e,o,i=!1){if("undefined"==typeof b5toast)return console.error("O objeto b5toast (ficheiro JS) n\xe3o existe. Efetue o seu download, para as mensagens funcionem!"),!1;let s=this.#c(e),t=null;for(let r=0;r<s.length;r++)if(s[r][0]==o){t=s[r];break}if(null!=t){let a=this.#c("tipos_mensagens",t[1]);b5toast.show(a[2],a[3]+t[2]+": "+t[3],i?a[1]:"",this.msgs.tempo_de_espera)}else b5toast.show("danger","Variavel n\xe3o encontrada: "+e,"ERRO",this.msgs.tempo_de_espera)}#h(e){return $("#"+e)}Adiciona_Erros(e=[]){0===this.erros.length&&2==e.length&&this.erros.push(new formulario_erros("Construtor","O objeto n\xe3o \xe9 um formul\xe1rio"))}Apaga_Erros(e){for(let o=0;o<this.erros.length;o++)this.erros[o].funcao.toUpperCase()===e.toUpperCase()&&this.erros[o].splice(o,1)}ObterElementos(){0===this.erros.length&&(this.formulario.elementos=this.formulario.find(this.formulario.encontrarobjetos).filter(this.formulario.filtro),this.formulario.num_elementos=this.formulario.elementos.length)}#e(){if(0===this.erros.length){let e=0;this.ObterElementos(),this.formulario.vetores=new formulario_objetos([],[],[],[]);for(let o=0;o<this.formulario.num_elementos;o++)if(e=$(this.formulario.elementos[o]).hasAttr("formulario-numobj")?parseInt($(this.formulario.elementos[o]).attr("formulario-numobj")):o,""!==this.formulario.elementos[o].id){let i=[];i=this.formulario.elementos[o].id.includes("chk")?[e,this.formulario.elementos[o].id,this.formulario.elementos[o].checked?1:0,$(this.formulario.elementos[o]).hasClass(constantes.classe_esconde)]:[e,this.formulario.elementos[o].id,this.formulario.elementos[o].value,$(this.formulario.elementos[o]).hasClass(constantes.classe_esconde)],this.formulario.objetos.push(new formulario_objetos(...i)),this.formulario.vetores.num.push(i[0]),this.formulario.vetores.id.push(i[1]),this.formulario.vetores.valor.push(i[2]),this.formulario.vetores.escondido.push(i[3])}}}#i(e=[]){if(0===this.erros.length){if(-1==this.#j(e[0]))return console.log("TESTA_ENTRADA_DADOS: O objeto n\xe3o existe no formul\xe1rio: "+e[0]),!1;if("string"!=typeof e[1])return console.log("TESTA_ENTRADA_DADOS: O objeto n\xe3o \xe9 texto. "+e[1]),!1;if("string"!=typeof e[2])return console.log("TESTA_ENTRADA_DADOS: O objeto n\xe3o \xe9 texto para o erro."+e[2]),!1;else if(4==e.length&&"boolean"!=typeof e[3])return console.log("TESTA_ENTRADA_DADOS: O objeto n\xe3o \xe9 um valor booleano. "+e[3]),!1;return!0}return console.log("TESTA_ENTRADA_DADOS: Existem erros no formul\xe1rio"),!1}Adiciona_Validacoes(e=[]){if(0===this.erros.length)return[3,4].includes(e.length)&&this.#i(e)?(this.validacoes.push(new formulario_validacoes(...e)),!0):(console.log("ADICIONA_VALIDACOES: Deve introduzir 3 ou 4 dados como vetor ([id ou formulario-numobj do objeto, string de compara\xe7\xe3o, string com a mensagem de erro]): \n"+e.length+" -- "+JSON.stringify(e)),!1);console.log("ADICIONA_VALIDACOES: O objeto definido n\xe3o \xe9 um formul\xe1rio")}#k(e,o){return o.indexOf(e)}#l(e){let o=-1;return e.includes("?")?(o=this.formulario.vetores.id.filter(o=>o.includes(e.replace("?",""))).length-1)>-1&&(o=this.#k(this.formulario.vetores.id.filter(o=>o.includes(e.replace("?","")))[0],this.formulario.vetores.id)):-1==(o=this.#k(e,this.formulario.vetores.num))&&(o=this.#k(e,this.formulario.vetores.id)),o}#j(e){if(void 0===e)return console.error(`VERIFICA_ELEMENTO_EXISTE: = O ID do objeto ${e} \xe9 indefinido!`),-1;if("int"!=typeof e&&"string"!=typeof e)return console.error(`VERIFICA_ELEMENTO_EXISTE: O n\xfamero ou o id do objeto ${e} do tipo errado!`),-1;let o=this.#l(e);return -1==o?(console.error(`VERIFICA_ELEMENTO_EXISTE: O objeto ${e} n\xe3o existe no formul\xe1rio!`),-1):o}#m(e){let o=[];if(0==this.validacoes.length)return console.error(`VERIFICA_ELEMENTO_VALIDACAO_EXISTE: N\xe3o existem valida\xe7\xf5es para testar!`),-1;for(let i=0;i<this.validacoes.length;++i)void 0!=e?$(this).id==e&&o.push(i):o.push(i);return 0==o.length?(console.error(`VERIFICA_ELEMENTO_VALIDACAO_EXISTE: O objeto ${e} n\xe3o existe nas valida\xe7\xf5es!`),-1):o}#n(e,o,i,s=!1){if(!e.includes(o)||!e.includes(i))return console.error(`DEVOLVE_TEXTO_ENTRE_LIMITADORES: O objeto ${e} n\xe3o cont\xe9m os limitadores ${o} ou ${i}!`),-1;{let t=e.indexOf(o)+o.length+(s?-1:0),r=e.indexOf(i,t)+(s?1:0);return e.substring(t,r)}}#o(e){return"[object Object]"===Object.prototype.toString.call(e)}#p(e,o){if(void 0==e||void 0==o)return;let i,s=e.split(".");return"php"==s[s.length-1]?$.ajax({url:e,type:"POST",data:JSON.parse(o.toString()),async:!1,success:function(e){i=e},error:function(e,o,s){i=e.status+" - "+e.responseText,console.log(i)}}):$.ajax({url:e,type:"POST",data:JSON.parse(o.toString()),contentType:!1,cache:!1,processData:!1,success:function(e){i=e},error:function(e,o,s){i=e.status+" - "+e.responseText,console.log(i)}}),i}#q(e){let o,i=$(this.id).serialize();return $.ajax({url:e,type:"POST",data:i,async:!1,success:function(e){o=e},error:function(e,i,s){o=e.status+" - "+e.responseText}}),o}#r(e,o=0,i=!0){let s=[-1,-1],t=[0,0];if(-1==(o=e.indexOf(limitadores.inicial,o)))return s;for(let r=o;r<=e.length;++r)if(e[r]==limitadores.inicial)t[0]++,s[0]=r+(i?0:1);else if(e[r]==limitadores.final){s[1]=r+(i?1:0);break}return s}#s(e,o=0){let i=e,s=0;for(;-1!=i.indexOf(limitadores.inicial,o)&&!(++s>3);){let t=this.#r(i,o),r=i.substring(t[0],t[1]),a=[];r.includes("data_address")||r.includes("form_address")?a.push(r.substr(1,r.length-2)):r.includes(limitadores.separador)?(a.push(r.split(limitadores.separador)[0].replace(limitadores.inicial,"").replace(limitadores.final,"")),a.push(r.split(limitadores.separador)[1].replace(limitadores.inicial,"").replace(limitadores.final,"").toLowerCase())):a.push(r.replace(limitadores.inicial,"").replace(limitadores.final,""));let l;if(console.log("TAMANHO DAS PARTES: "+a.length+"\nPARTE1: "+a[0]+"\nPARTE2: "+a[1]),1==a.length){if(a[0].includes("data_address")){if(-1==a[0].indexOf(limitadores.valores_inicial)||-1==a[0].indexOf(limitadores.valores_final))l=`ERRO AO AVALIAR A PROPRIEDADE DATA_ADDRESS: Existem um ou os dois limitadores dos dados  - ${limitadores.valores_inicial} ou ${limitadores.valores_final}`;else{l=this.#n(a[0],limitadores.valores_inicial,limitadores.valores_final,!1);try{if(l=l.split(limitadores.separador_valores),void 0==l[0]||"string"!=typeof l[0])l=`ERRO AO AVALIAR A PROPRIEDADE VAL_ADDRESS: Valor de LINK (${l[0]})`;else if(void 0==l[1]||"string"!=typeof l[1])l=`ERRO AO AVALIAR A PROPRIEDADE VAL_ADDRESS: Valor de DATA inv\xe1lida (${l[1]})`;else{let n=this.#p(l[0],l[1]);l=$.isNumeric(n)?parseInt(n):n}}catch(c){l="ERRO AO AVALIAR A PROPRIEDADE VAL_ADDRESS: "+c.toString()}}}else if(a[0].includes("form_address")){l=this.#n(a[0],limitadores.valores_inicial,limitadores.valores_final,!1);try{if(l=l.split(limitadores.separador_valores),void 0==l[0]||"string"!=typeof l[0])l=`ERRO AO AVALIAR A PROPRIEDADE FORM_ADDRESS: Valor de LINK inv\xe1lido (${l[0]})`;else if(void 0!=l[1]&&"string"==typeof l[1]&&$("#"+l[1]).is("form")){let d=this.#q(l[0],l[1]);l=$.isNumeric(d)?parseInt(d):d}else l=`ERRO AO AVALIAR A PROPRIEDADE FORM_ADDRESS: Valor de DATA inv\xe1lida (${l[1]})`}catch(u){l=`ERRO AO AVALIAR A PROPRIEDADE VAL_ADDRESS_FORM: ${u.toString()}`}}}else"val"==a[1]||"value"==a[1]?l=$("#"+a[0]).val():"valemail"==a[1]||"email"==a[1]?l=constantes.email_regex.test($("#"+a[0]).val()):"check"==a[1]||"checked"==a[1]?l=$("#"+a[0]).is(":checked"):"length"==a[1]||"len"==a[1]?a[0].includes("?")?(a[0]=a[0].replace("?",""),l=$("input[name*='"+a[0]+"']:checked").length):l=$("#"+a[0]).val().length:a[1].includes("isnumeric")?l=!$.isNumeric($("#"+a[0]).val()):a[1].includes("includes")?a[1].includes(limitadores.includes_inicial)&&a[1].includes(limitadores.includes_final)?(l=this.#n(a[1],limitadores.includes_inicial,limitadores.includes_final),l=$("#"+a[0]).val().includes(l)):l="ERRO AO AVALIAR A PROPRIEDADE INCLUDES":a[1].includes("indexof")?a[1].includes(limitadores.includes_inicial)&&a[1].includes(limitadores.includes_final)?(l=this.#n(a[1],limitadores.includes_inicial,limitadores.includes_final),l=$("#"+a[0]).val().indexOf(l)):l="ERRO AO AVALIAR A PROPRIEDADE INDEXOF":l="ERRO DE PROPRIEDADE N\xc3O IDENTIFICADO";void 0!=l&&"string"===(typeof l).toLowerCase()&&(l=`"${l}"`),console.log(`STR_OBJETO: ${r}
STR_OBJECTO_VALOR: ${l}`),i=i.replace(r,l)}return i}#t(e){if(0!==this.erros.length)return console.log(`TESTES_INICIAIS: O objeto ${this.formulario} definido n\xe3o \xe9 um formul\xe1rio!`),!1;if("int"==typeof e||"string"==typeof e)return console.log(`TESTES_INICIAIS: O objeto ${e} definido n\xe3o \xe9 do tipo correcto (int ou string)!`),!1;if(void 0!=e){if(-1==this.#j(e))return console.log(`TESTES_INICIAIS: O objeto ${e} definido n\xe3o existe no formul\xe1rio!`),!1;if(this.#h(e).hasClass("is-invalid"))return console.log(`TESTES_INICIAIS: O objeto ${e} j\xe1 est\xe1 validado com erro!`),!1}return!0}#u(e,o,i=!0){if(void 0==e||!Number.isInteger(e))return console.log(`COLOCAR_ESTADO_CAIXA: N\xe3o foi indicado o valor inteiro da posi\xe7\xe3o do objeto, valor: ${e}`),!1;if(void 0==o||"boolean"!=typeof o)return console.log(`COLOCAR_ESTADO_CAIXA: N\xe3o foi indicado o valor booleano do erro do objeto, valor: ${o}`),!1;let s=this.validacoes[e].id.includes("?")?this.validacoes[e].id.replace("?",""):this.validacoes[e].id,t="#"+s,r="#"+constantes.prefixo_obj_erro+s,a=constantes.classe_geral_invalido,l=constantes.classe_geral_valido;switch($(t).is("input,select,textarea")||(a=constantes.classe_obj_invalido,l=constantes.classe_obj_valido),this.tipo_aviso){case tipos_aviso.aviso_tooltip:$(t).attr("data-bs-toggle","tooltip_c_formulario");break;case tipos_aviso.aviso_texto:let n=$(t).closest("div");$(t).is(":checkbox")||this.validacoes[e].id.includes("?")?n.parent().find(r).length||n.after(`<div id="${r.replace("#","")}" class="${constantes.classe_erro} ${constantes.classe_esconde}"></div>`):n.find(r).length||n.append(`<div id="${r.replace("#","")}" class="${constantes.classe_erro} ${constantes.classe_esconde}"></div>`);case tipos_aviso.aviso_toast:}if(o){switch(0==$(".toast").length&&this.#f("formulario",0),$(t).removeClass(l),$(t).addClass(a),this.tipo_aviso){case tipos_aviso.aviso_tooltip:$(t).atualiza_tooltip_c_formulario(this.validacoes[e].texto_erro);break;case tipos_aviso.aviso_texto:void 0!==$(r)&&($(r).removeClass(constantes.classe_esconde),$(r).html(this.validacoes[e].texto_erro));case tipos_aviso.aviso_toast:}i&&$(t).focus()}else switch($(t).removeClass(a),$(t).addClass(l),this.tipo_aviso){case tipos_aviso.aviso_tooltip:$(t).apaga_tooltip();break;case tipos_aviso.aviso_texto:void 0===$(r)||$(r).hasClass(constantes.classe_esconde)||$(r).addClass(constantes.classe_esconde).text("");case tipos_aviso.aviso_toast:}}Testa_Validacoes(num_ou_nome_objeto,coloca_focus_erro=!0){if(!this.#t(num_ou_nome_objeto))return!1;$.each(this.formulario.objetos,function(){this.testado=!1}),this.#e();let posicoes_validacoes_testar=this.#m(num_ou_nome_objeto),existe_erros=!1;for(let i=0;i<=posicoes_validacoes_testar.length-1;++i){let pos_objeto=this.#l(this.validacoes[i].id);if(-1==pos_objeto||this.formulario.objetos[pos_objeto].testado||this.formulario.objetos[pos_objeto].escondido)continue;let txtcomparacao=this.#s(this.validacoes[i].comparacao);if(""==txtcomparacao){console.log("TESTA_VALIDACOES: ("+this.validacoes[i].id+") - Express\xe3o de compara\xe7\xe3o vazia: "+txtcomparacao);continue}let resultado=-1;try{resultado=eval?.(txtcomparacao),this.validacoes[i].mostra_resultado&&alert(`Compara\xe7\xe3o: ${txtcomparacao} - Resultado: ${resultado}`)}catch(e){}if("boolean"!=typeof resultado){console.error("TESTA_VALIDACOES: ("+num_ou_nome_objeto+") - Erro ao executar a express\xe3o: "+txtcomparacao);continue}this.#u(i,resultado,coloca_focus_erro),resultado&&(this.formulario.objetos[pos_objeto].testado=!0,existe_erros||(existe_erros=!0,coloca_focus_erro=!1))}return existe_erros}Limpar_Validacoes(e=!0){this.#v(),e?this.formulario.trigger("reset"):this.formulario.limpar_espacos()}#v(e){if(void 0==e||!Number.isInteger(e))return console.log(`LIMPAR_CAIXA_ERRO: N\xe3o foi indicado o valor inteiro da posi\xe7\xe3o do objeto, valor: ${e}`),!1;if(void 0===num_ou_nome_objeto)for(let o=0;o<this.validacoes.length;++o){let i=this.validacoes[o].id.includes("?")?this.validacoes[o].id.replace("?",""):this.validacoes[o].id,s="#"+i,t="#"+constantes.prefixo_obj_erro+i,r=constantes.classe_geral_invalido,a=constantes.classe_geral_valido;$(s).is("input,select,textarea")||(r=constantes.classe_obj_invalido,a=constantes.classe_obj_valido),void 0!=s&&(s.hasClass(a)&&s.removeClass(a),s.hasClass(r)&&s.removeClass(r)),void 0==t||t.hasClass(constantes.classe_esconde)||t.addClass(constantes.classe_esconde)}else{let l=this.validacoes[e].id.includes("?")?this.validacoes[e].id.replace("?",""):this.validacoes[e].id,n=$("#"+l),c=$("#"+constantes.prefixo_obj_erro+l);void 0!=n&&(n.hasClass(classe_valido)&&n.removeClass(classe_valido),n.hasClass(classe_erro)&&n.removeClass(classe_erro)),void 0==c||c.hasClass(constantes.classe_esconde)||c.addClass(constantes.classe_esconde)}}}